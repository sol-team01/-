<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hac.mapper.LoginMapper">
	<!-- resultType 에 복수형(ArrayList 등)을 적는게 아님. 그냥 vo 단수의 경로를 적어야됨. -->
	

	
				<!--  아이디 중복검사 0 true --> 
	<select id="countId" parameterType="com.hac.dto.searchDto.LoginDto">
		SELECT IFNULL(COUNT(*),0) FROM user WHERE U_id = #{U_id}
	</select>	
	
				<!--  닉네임 중복검사 0 true -->
	<select id="countName" parameterType="com.hac.dto.searchDto.LoginDto">
		SELECT IFNULL(COUNT(*),0) FROM info WHERE I_name = #{I_name}
	</select>	

				<!-- 아이디 생성 -->
	<insert id="signUp" parameterType="com.hac.dto.searchDto.LoginDto">
		INSERT INTO user(U_id,U_pw) value (#{U_id},#{U_pw})
	</insert>

				<!--  회원가입할때 유저 번호를 불러옴-->	
	<select id="searchUser" parameterType="com.hac.dto.searchDto.LoginDto">
		SELECT U_no FROM user WHERE U_id = #{U_id} AND U_pw = #{U_pw}
	</select>

				<!--  회원정보 생성 -->
	<insert id="signUpInfo" parameterType="com.hac.dto.userDto.InfoDto">
		INSERT INTO info
			(U_no,I_name,I_weight,I_height,I_email,I_pwFinding,I_hint)
		VALUE 
			(#{U_no},#{I_name},#{I_weight},#{I_height},#{I_email},#{I_pwFinding},#{I_hint})
	</insert>

				<!-- 로그인 -->
	<select id="idPwCheck" parameterType="com.hac.dto.searchDto.LoginDto">
	SELECT IFNULL(COUNT(*),0) FROM user WHERE U_id = #{U_id} and U_pw = #{U_pw}
	</select>

				<!--  유저 로그인 -->
				
	<select id = "login" parameterType="com.hac.dto.searchDto.LoginDto">
	SELECT U_no FROM user WHERE U_id = #{U_id} AND U_pw = #{U_pw}
	</select>

				<!--  유저 번호로 정보를 불러옴 -->
	<select id = "searchInfo" resultType="com.hac.dto.userDto.InfoDto" >
		SELECT info.* FROM info WHERE U_no = #{U_no}
	</select>

				<!-- 아이디 찾기 -->
	<select id="searchId" resultType="String"  parameterType="com.hac.dto.searchDto.LoginDto">
		SELECT user.U_id FROM info JOIN user ON info.U_no = user.U_no WHERE info.I_email = #{I_email}
	</select>


				<!-- 비밀번호 찾기 -->
				
					<!-- 등록한 질문 찾기 -->
	<select id="searchFinding" parameterType="com.hac.dto.searchDto.LoginDto">
		SELECT info.I_pwFinding FROM user JOIN info ON user.U_no = info.U_no WHERE user.U_id = #{U_id} 
	</select>
					<!-- 등록한 질문을 맞추면 비밀번호 바꿀수있게. -->
	<select id="searchpw"  resultType = "String" parameterType="com.hac.dto.searchDto.LoginDto">
		SELECT user.U_no FROM info JOIN user ON info.U_no = user.U_no WHERE info.I_hint = #{I_hint}
	</select>
	
	<update id="pwChange" parameterType="com.hac.dto.searchDto.LoginDto">
		UPDATE user SET U_pw = #{U_pw} WHERE U_no = #{U_no}
	</update>
	
	

</mapper>